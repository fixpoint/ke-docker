x-logging:
  &default-logging
  driver: fluentd
  options:
    fluentd-async-connect: "true"
    tag: "docker.{{.Name}}"

services:
  fluentd:
    logging: *default-logging
    restart: always
  redis:
    logging: *default-logging
    depends_on:
      - fluentd
    restart: always
  rabbitmq:
    logging: *default-logging
    depends_on:
      - fluentd
    restart: always
  jobmngrd:
    logging: *default-logging
    depends_on:
      - fluentd
      - rabbitmq
    restart: always
  kengine:
    volumes:
      - type: bind
        source: ./.secret_key
        target: /var/opt/kompira/.secret_key
    logging: *default-logging
    depends_on:
      - fluentd
      - redis
      - rabbitmq
    restart: always
  kompira:
    volumes:
      - type: bind
        source: ./.secret_key
        target: /var/opt/kompira/.secret_key
    logging: *default-logging
    depends_on:
      - fluentd
      - redis
      - kengine
    restart: always
  nginx:
    logging: *default-logging
    depends_on:
      - fluentd
      - kompira
    restart: always
